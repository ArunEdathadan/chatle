$(function(){"use strict";$.connection.hub.logging=!0;var a=$.connection.chat,b={users:ko.observableArray(),messages:ko.observableArray(),unreadMessages:ko.observableArray(),currentUser:ko.observable(),sendMessage:function(a){var c={to:b.currentUser(),text:a};$.ajax("api/chat",{data:c,method:"POST"}).done(function(){mode.from="Me",messages.unshift(c)})},showMessage:function(a){b.currentUser(a),$.getJSON("api/chat/"+a).done(function(a){b.messages(a)}),b.unreadMessages.remove(function(b){return b.from==a})},messageReceived:function(a){a&&(b.currentUser()==a.from?b.messages.unshift(a):b.unreadMessages.unshift(a))}};a.client.userConnected=function(a){console.log("Chat Hub newUserConnected "+a);var c=b.users;-1==c.indexOf(a)&&b.users.push(a)},a.client.userDisconnected=function(a){console.log("Chat Hub userDisconnected "+a),b.users.remove(a)},a.client.messageReceived=function(a){b.messageReceived(a)},$.connection.hub.stateChanged(function(a){var b=null,c=null;for(var d in $.signalR.connectionState)$.signalR.connectionState[d]===a.oldState&&(b=d),$.signalR.connectionState[d]===a.newState&&(c=d);console.log("Chat Hub state changed from "+b+" to "+c)}),$.connection.hub.reconnected(function(){console.log("Chat Hub reconnect")}),$.connection.hub.error(function(){console.log("Chat Hub error")}),$.connection.hub.disconnected(function(){console.log("Chat Hub disconnected")}),$.connection.hub.start().done(function(){console.log("Chat Hub started"),$.getJSON("api/users").done(function(a){b.users(a)})}),ko.applyBindings(b)});